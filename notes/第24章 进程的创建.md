# 第24章 进程的创建

### 24.1 fork()、exit()、wait()以及 execve()的简介

- fork()创建一个和原来几乎一模一样的子进程，获得和父进程相同的栈、数据段、堆和文本段的拷贝。
- exit(&status)终止进程，它在_exit()的上层。它把进程所占用的所有资源（内存、文件描述符等）归还内核，交其进行重新分配。参数status为一整型变量，表示进程的退出状态，可由父进程通过wait()获取。
- wait(&status)，等待子进程的终止，接收终止的子进程的状态。
- execve(pathname,argv,envp)，加载一个新程序（路径名pathname,参数列表argv,环境envp）。它会丢弃现存程序文本段，为新程序重新创建栈、堆、数据段，开始新程序。

*下面是一个相互协作的示例：*

![image-20230505204935708](assets/image-20230505204935708.png)



### 24.2 创建新进程：fork()

fork()创建一个子进程，文本段完全相同，数据段、栈和堆则另外独立地复制一份。

```cpp
#include <unistd>
pid_t fork(void);   /*In parent:returns process ID of child on success,or -1 on error;
		 			  In successfully created child:always returns 0
```

创建失败的原因可能是达到了系统对此真实用户设置的上限(RLIMIT_NPROC)，也可能是突破了系统创建的最大进程数这一系统级上限。

fork()之后每个进程都会从fork()的返回处继续执行。注意，调用fork()之后，系统先垂青哪个进程是不确定的（当然你可以对其进行人为干扰，比如wait()一下）

#### 24.2.1 父子进程间的文件共享
